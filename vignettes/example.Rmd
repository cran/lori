---
title: "Analysis of count data with covariates in R using LORI - tutorial"
author: "Genevieve Robin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of count data with covariates in R using LORI - tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# LORI (LOw-Rank Interaction) model for count data with covariates

The LORI model is designed to analyse count data with covariates, using a Poisson log-linear model. In particular, it can be used to assess the effect of temporal and geographical covariates on species abundances. 

Let $Y\in\mathbb{N}^{n\times p}$ be a (incomplete) matrix of counts, and $L\in\mathbb{R}^{np\times K}$ a matrix of covariates about the rows and columns of $Y$. For example if $Y$ counts the abundance of species across sites (rows) and time stamps (columns), $L$ might contain temporal, spatial, and spatio-temporal information. 

```{r data-example}
library(lori)
library(glmnet)
library(gridExtra)
data("aravo")
```

## Example: Aravo data set
The \url{http://dx.doi.org/10.1657/1523-0430(2005)037[0444:CSIAPT]2.0.CO;2}{Aravo data set} measures the abundance of $82$ species of alpine plants in $75$ sites in France. The data consist of a contingency table collecting the abundance of species across sampling sites. Covariates about the environments and species are also available.
```{r create-covariate-matrix}
# Environment characteristics
head(aravo$env)

# Species traits
head(aravo$traits)

d <- dim(aravo$spe)
n <- d[1]
p <- d[2]

# Create covariate matrix, choose quantitative variables in Row and Column covariates
# and use covmat function to replicate species/environments
# center and scale covariate matrix
cov <- scale(covmat(aravo$env[, c(1,2,4,6)], aravo$traits, n, p))
```

```{r apply-lori}
lambda1 <- qut(aravo$spe, cov)
res <- lori(aravo$spe, cov, lambda1=lambda1, lambda2=0, trace.it = T)
res$alpha
plot(svd(res$theta)$d)
```




